<?php
/* 
 * Generated by CRUDigniter v3.2 
 * www.crudigniter.com
 */
 
class Reportes extends CI_Controller{
    function __construct()
    {
        parent::__construct();
        $this->load->model('Reporte_ing_egr_model');
        
    } 
    /*
     * Listing of cliente
     */
    function index()
    {
        if ($this->session->userdata('logged_in')) {
            $session_data = $this->session->userdata('logged_in');
            if($session_data['tipousuario_id']==1) {
                $data = array(
                    'page_title' => 'Admin >> Mi Cuenta'
                );
        $this->load->model('Empresa_model');
        $data['all_empresa'] = $this->Empresa_model->get_all_empresa();
        $fecha1  = Date("Y-m-d");
        $fecha2  = $fecha1;
        $data['ingresos'] = $this->Reporte_ing_egr_model->get_reportes($fecha1, $fecha2);

        $data['_view'] = 'reportes/index';
        $this->load->view('layouts/main',$data);
        }
            else{
                redirect('alerta');
            }
        } else {
            redirect('', 'refresh');
        }
    }

    /*
     * Reporte de Ingresos y Salidas
     */
    function buscarlosreportes()
    {
        if ($this->session->userdata('logged_in')) {
            $session_data = $this->session->userdata('logged_in');
            if($session_data['tipousuario_id']==1) {
                $data = array(
                    'page_title' => 'Admin >> Mi Cuenta'
                );
        if ($this->input->is_ajax_request()) {
            
            $fecha1 = $this->input->post('fecha1');   
            $fecha2 = $this->input->post('fecha2');
            $valfecha1 = "";
            $valfecha2 = "";

            if(!($fecha1 == null || empty($fecha1)) && !($fecha2 == null || empty($fecha2))){
                $valfecha1 = $fecha1;
                $valfecha2 = $fecha2;
            }elseif(!($fecha1 == null || empty($fecha1)) && ($fecha2 == null || empty($fecha2))){
                $valfecha1 = $fecha1;
                $valfecha2 = $fecha1;
            }elseif(($fecha1 == null || empty($fecha1)) && !($fecha2 == null || empty($fecha2))) {
                $valfecha1 = $fecha2;
                $valfecha2 = $fecha2;
            }else{
                $fecha1 = null;
                $fecha2 = null;
            }
            
            $datos = $this->Reporte_ing_egr_model->get_reportes($valfecha1, $valfecha2);
            echo json_encode($datos);
        }   
        else
        {                 
            show_404();
        }
        }
            else{
                redirect('alerta');
            }
        } else {
            redirect('', 'refresh');
        }
    }

    /*
     * Menu de Reportes de Compras
     */
    function comprareportes()
    {
        if ($this->session->userdata('logged_in')) {
            $session_data = $this->session->userdata('logged_in');
            if($session_data['tipousuario_id']==1) {
                $data = array(
                    'page_title' => 'Admin >> Mi Cuenta'
                );

        $data['_view'] = 'reportes/comprareportes';
        $this->load->view('layouts/main',$data);
        }
            else{
                redirect('alerta');
            }
        } else {
            redirect('', 'refresh');
        }
    }

    /*
     * Menu de Reportes de Ventas
     */
    function ventareportes()
    {
        if ($this->session->userdata('logged_in')) {
            $session_data = $this->session->userdata('logged_in');
            if($session_data['tipousuario_id']==1) {
                $data = array(
                    'page_title' => 'Admin >> Mi Cuenta'
                );

        $data['_view'] = 'reportes/ventareportes';
        $this->load->view('layouts/main',$data);
        }
            else{
                redirect('alerta');
            }
        } else {
            redirect('', 'refresh');
        }
    }

    /*
     * Menu de Reportes de Servicios
     */
    function servicioreportes()
    {
        if ($this->session->userdata('logged_in')) {
            $session_data = $this->session->userdata('logged_in');
            if($session_data['tipousuario_id']==1) {
                $data = array(
                    'page_title' => 'Admin >> Mi Cuenta'
                );

        $data['_view'] = 'reportes/servicioreportes';
        $this->load->view('layouts/main',$data);
        }
            else{
                redirect('alerta');
            }
        } else {
            redirect('', 'refresh');
        }
    }
}
    
