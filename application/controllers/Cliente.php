<?php
/* 
 * Generated by CRUDigniter v3.2 
 * www.crudigniter.com
 */
 
class Cliente extends CI_Controller{
    function __construct()
    {
        parent::__construct();
        $this->load->model('Cliente_model');
    } 

    /*
     * Listing of cliente
     */
    function index($a = null)
    {
        if ($this->session->userdata('logged_in')) {
            $session_data = $this->session->userdata('logged_in');
            if($session_data['tipousuario_id']==1 or $session_data['tipousuario_id']==4) {
               $data = array(
                    'page_title' => 'Admin >> Mi Cuenta'
                );

        $data['a'] = $a;
        $data['err'] ="";
        //$data['cliente'] = $this->Cliente_model->get_cliente_all();
        
        $this->load->model('Tipo_cliente_model');
        $data['all_tipo_cliente'] = $this->Tipo_cliente_model->get_all_tipo_cliente_asc();
        
        $this->load->model('Categoria_cliente_model');
        $data['all_categoria_cliente'] = $this->Categoria_cliente_model->get_all_categoria_cliente_asc();
        
        $this->load->model('Categoria_clientezona_model');
        $data['all_categoria_clientezona'] = $this->Categoria_clientezona_model->get_all_categoria_clientezona_asc();
        
        $this->load->model('Usuario_model');
        $data['all_usuario'] = $this->Usuario_model->get_todos_usuario();
        
        $data['_view'] = 'cliente/index';
        $this->load->view('layouts/main',$data);
        }
            else{
                redirect('alerta');
            }
        } else {
            redirect('', 'refresh');
        }
    }

    /*
     * Adding a new cliente
     */
    function add()
    {
        if ($this->session->userdata('logged_in')) {
            $session_data = $this->session->userdata('logged_in');
            if($session_data['tipousuario_id']==1 or $session_data['tipousuario_id']==4) {
                $data = array(
                    'page_title' => 'Admin >> Mi Cuenta'
                );
            $this->load->library('form_validation');

            //$this->form_validation->set_rules('cliente_codigo','Cliente Codigo','required');
            $this->form_validation->set_rules('cliente_nombre','Cliente Nombre','trim|required', array('required' => 'Este Campo no debe ser vacio'));
            //$this->form_validation->set_rules('cliente_nombrenegocio','Nombre Negocio','required');

            if($this->form_validation->run())     
            {
                /* *********************INICIO imagen***************************** */
                $foto="";
                if (!empty($_FILES['cliente_foto']['name'])){
                        $this->load->library('image_lib');
                        $config['upload_path'] = './resources/images/clientes/';
                        $img_full_path = $config['upload_path'];

                        $config['allowed_types'] = 'gif|jpeg|jpg|png';
                        $config['max_size'] = 0;
                        $config['max_width'] = 5900;
                        $config['max_height'] = 5900;
                        
                        $new_name = time(); //str_replace(" ", "_", $this->input->post('proveedor_nombre'));
                        $config['file_name'] = $new_name; //.$extencion;
                        $config['file_ext_tolower'] = TRUE;

                        $this->load->library('upload', $config);
                        $this->upload->do_upload('cliente_foto');

                        $img_data = $this->upload->data();
                        $extension = $img_data['file_ext'];
                        /* ********************INICIO para resize***************************** */
                        if ($img_data['file_ext'] == ".jpg" || $img_data['file_ext'] == ".png" || $img_data['file_ext'] == ".jpeg" || $img_data['file_ext'] == ".gif") {
                            $conf['image_library'] = 'gd2';
                            $conf['source_image'] = $img_data['full_path'];
                            $conf['new_image'] = './resources/images/clientes/';
                            $conf['maintain_ratio'] = TRUE;
                            $conf['create_thumb'] = FALSE;
                            $conf['width'] = 800;
                            $conf['height'] = 600;
                            $this->image_lib->clear();
                            $this->image_lib->initialize($conf);
                            if(!$this->image_lib->resize()){
                                echo $this->image_lib->display_errors('','');
                            }
                        }
                        /* ********************F I N  para resize***************************** */
                        $confi['image_library'] = 'gd2';
                        $confi['source_image'] = './resources/images/clientes/'.$new_name.$extension;
                        $confi['new_image'] = './resources/images/clientes/'."thumb_".$new_name.$extension;
                        $confi['create_thumb'] = FALSE;
                        $confi['maintain_ratio'] = TRUE;
                        $confi['width'] = 50;
                        $confi['height'] = 50;

                        $this->image_lib->clear();
                        $this->image_lib->initialize($confi);
                        $this->image_lib->resize();

                        $foto = $new_name.$extension;
                    }
            /* *********************FIN imagen***************************** */
                $usuario_id = $session_data['usuario_id'];
                //no es necesario porque se esta usando el date y ya no el date piker
                //$mifecha = $this->Cliente_model->normalize_date($this->input->post('cliente_aniversario'));
                $estado_id = 1;
                $params = array(
                            'estado_id' => $estado_id,
                            'tipocliente_id' => $this->input->post('tipocliente_id'),
                            'categoriaclie_id' => $this->input->post('categoriaclie_id'),
                            'cliente_codigo' => $this->input->post('cliente_codigo'),
                            'cliente_nombre' => $this->input->post('cliente_nombre'),
                            'cliente_ci' => $this->input->post('cliente_ci'),
                            'cliente_direccion' => $this->input->post('cliente_direccion'),
                            'cliente_telefono' => $this->input->post('cliente_telefono'),
                            'cliente_celular' => $this->input->post('cliente_celular'),
                            'cliente_foto' => $foto,
                            'cliente_email' => $this->input->post('cliente_email'),
                            'cliente_nombrenegocio' => $this->input->post('cliente_nombrenegocio'),
                            'cliente_aniversario' => $this->input->post('cliente_aniversario'),
                            'cliente_latitud' => $this->input->post('cliente_latitud'),
                            'cliente_longitud' => $this->input->post('cliente_longitud'),
                            'cliente_nit' => $this->input->post('cliente_nit'),
                            'cliente_razon' => $this->input->post('cliente_razon'),
                            'usuario_id' => $this->input->post('usuario_id'),
                            'zona_id' => $this->input->post('zona_id'),
                );
            
            $cliente_id = $this->Cliente_model->add_cliente($params);
            redirect('cliente/index');
        }
        else
        {
			$this->load->model('Estado_model');
			$data['all_estado'] = $this->Estado_model->get_all_estado_activo_inactivo();
                        
                        $this->load->model('Categoria_clientezona_model');
                        $data['zona'] = $this->Categoria_clientezona_model->get_all_categoria_clientezona();
                        /***AÃ±adido por Mario Escobar parqa asignarle a un usuario prevendedor***/
                        $this->load->model('Usuario_model');
			$data['all_usuario_prev'] = $this->Usuario_model->get_all_usuario_prev_activo();

			$this->load->model('Tipo_cliente_model');
			$data['all_tipo_cliente'] = $this->Tipo_cliente_model->get_all_tipo_cliente();
			
                        $this->load->model('Categoria_cliente_model');
			$data['all_categoria_cliente'] = $this->Categoria_cliente_model->get_all_categoria_cliente();
			
            
            $data['_view'] = 'cliente/add';
            $this->load->view('layouts/main',$data);
        }
        }
            else{
                redirect('alerta');
            }
        } else {
            redirect('', 'refresh');
        }
    }  

    /*
     * Editing a cliente
     */
    function edit($cliente_id)
    {
        if ($this->session->userdata('logged_in')) {
            $session_data = $this->session->userdata('logged_in');
            if($session_data['tipousuario_id']==1  or $session_data['tipousuario_id']==4) {
                $data = array(
                    'page_title' => 'Admin >> Mi Cuenta'
                );
        // check if the cliente exists before trying to edit it
        $data['cliente'] = $this->Cliente_model->get_cliente($cliente_id);
        
        if(isset($data['cliente']['cliente_id']))
        {
            $this->load->library('form_validation');

			//$this->form_validation->set_rules('cliente_codigo','Cliente Codigo','required');
			$this->form_validation->set_rules('cliente_nombre','Cliente Nombre','required');
                        //$this->form_validation->set_rules('cliente_nombrenegocio','Cliente Nombre Negocio','required');
		
	    if($this->form_validation->run())     
            {
                $usuario_id = $session_data['usuario_id'];
                /* *********************INICIO imagen***************************** */
                $foto="";
                $foto1= $this->input->post('cliente_foto1');
                if (!empty($_FILES['cliente_foto']['name']))
                {
                    $config['upload_path'] = './resources/images/clientes/';
                    $config['allowed_types'] = 'gif|jpeg|jpg|png';
                    $config['max_size'] = 0;
                    $config['max_width'] = 5900;
                    $config['max_height'] = 5900;

                    $new_name = time(); //str_replace(" ", "_", $this->input->post('proveedor_nombre'));
                    $config['file_name'] = $new_name; //.$extencion;
                    $config['file_ext_tolower'] = TRUE;
                    
                    $this->load->library('image_lib');
                    $this->image_lib->initialize($config);
                    
                    $this->load->library('upload', $config);
                    $this->upload->do_upload('cliente_foto');

                    $img_data = $this->upload->data();
                    $extension = $img_data['file_ext'];
                    /* ********************INICIO para resize***************************** */
                    if($img_data['file_ext'] == ".jpg" || $img_data['file_ext'] == ".png" || $img_data['file_ext'] == ".jpeg" || $img_data['file_ext'] == ".gif") {
                        $conf['image_library'] = 'gd2';
                        $conf['source_image'] = $img_data['full_path'];
                        $conf['new_image'] = './resources/images/clientes/';
                        $conf['maintain_ratio'] = TRUE;
                        $conf['create_thumb'] = FALSE;
                        $conf['width'] = 800;
                        $conf['height'] = 600;
                        
                        $this->image_lib->initialize($conf);
                        if(!$this->image_lib->resize()){
                            echo $this->image_lib->display_errors('','');
                        }
                        $this->image_lib->clear();
                    }
                    /* ********************F I N  para resize***************************** */
                    //$directorio = base_url().'resources/imagenes/';
                    $directorio = $_SERVER['DOCUMENT_ROOT'].'/ximpleman_web/resources/images/clientes/';
                    if(isset($foto1) && !empty($foto1)){
                      if(file_exists($directorio.$foto1)){
                          unlink($directorio.$foto1);
						  $mimagenthumb = "thumb_".$foto1;
                          unlink($directorio.$mimagenthumb);
                      }
                  }
                    $confi['image_library'] = 'gd2';
                    $confi['source_image'] = './resources/images/clientes/'.$new_name.$extension;
                    $confi['new_image'] = './resources/images/clientes/'."thumb_".$new_name.$extension;
                    $confi['create_thumb'] = FALSE;
                    $confi['maintain_ratio'] = TRUE;
                    $confi['width'] = 50;
                    $confi['height'] = 50;

                    $this->image_lib->clear();
                    $this->image_lib->initialize($confi);
                    $this->image_lib->resize();

                    $foto = $new_name.$extension;
                }else{
                    $foto = $foto1;
                }
            /* *********************FIN imagen***************************** */
                            //$this->input->post('cliente_foto'),
                           //$mifecha = $this->Cliente_model->normalize_date($this->input->post('cliente_aniversario'));
                            //$mifecha = normalize_date($this->input->post('cliente_aniversario'));
                $params = array(
					'estado_id' => $this->input->post('estado_id'),
					'tipocliente_id' => $this->input->post('tipocliente_id'),
					'categoriaclie_id' => $this->input->post('categoriaclie_id'),
					'cliente_codigo' => $this->input->post('cliente_codigo'),
					'zona_id' => $this->input->post('zona_id'),
					'cliente_nombre' => $this->input->post('cliente_nombre'),
					'cliente_ci' => $this->input->post('cliente_ci'),
					'cliente_direccion' => $this->input->post('cliente_direccion'),
					'cliente_telefono' => $this->input->post('cliente_telefono'),
					'cliente_celular' => $this->input->post('cliente_celular'),
					'cliente_foto' => $foto,
					'cliente_email' => $this->input->post('cliente_email'),
					'cliente_nombrenegocio' => $this->input->post('cliente_nombrenegocio'),
					'cliente_aniversario' => $this->input->post('cliente_aniversario'),
					'cliente_latitud' => $this->input->post('cliente_latitud'),
					'cliente_longitud' => $this->input->post('cliente_longitud'),
					'cliente_nit' => $this->input->post('cliente_nit'),
					'cliente_razon' => $this->input->post('cliente_razon'),
					'usuario_id' => $this->input->post('usuario_id'),
                );

                $this->Cliente_model->update_cliente($cliente_id,$params);            
                redirect('cliente/index');
            }
            else
            {
				$this->load->model('Estado_model');
				$data['all_estado'] = $this->Estado_model->get_all_estado_activo_inactivo();
                                
                                $this->load->model('Categoria_clientezona_model');
                                $data['all_categoria_clientezona'] = $this->Categoria_clientezona_model->get_all_categoria_clientezona();
                                /***AÃ±adido por Mario Escobar parqa asignarle a un usuario prevendedor***/
                                $this->load->model('Usuario_model');
			        $data['all_usuario_prev'] = $this->Usuario_model->get_all_usuario_prev_activo();

				$this->load->model('Tipo_cliente_model');
				$data['all_tipo_cliente'] = $this->Tipo_cliente_model->get_all_tipo_cliente();

				$this->load->model('Categoria_cliente_model');
				$data['all_categoria_cliente'] = $this->Categoria_cliente_model->get_all_categoria_cliente();

                $data['_view'] = 'cliente/edit';
                $this->load->view('layouts/main',$data);
            }
        }
        else
            show_error('The cliente you are trying to edit does not exist.');
        }
            else{
                redirect('alerta');
            }
        } else {
            redirect('', 'refresh');
        }
    } 

    /*
     * Deleting cliente
     */
    function remove($cliente_id)
    {
        if ($this->session->userdata('logged_in')) {
            $session_data = $this->session->userdata('logged_in');
            if($session_data['tipousuario_id']==1) {
        $cliente = $this->Cliente_model->get_cliente($cliente_id);

        // check if the cliente exists before trying to delete it
        if(isset($cliente['cliente_id']))
        {
            $res = $this->Cliente_model->cliente_es_usado($cliente_id);
            
            if($res == 0){
                $this->Cliente_model->delete_cliente($cliente_id);
                redirect('cliente/index');
            }else{
                $a = 1;
                redirect('cliente/index/'.$a);
            }
        }
        else
            show_error('The cliente you are trying to delete does not exist.');
        }
            else{
                redirect('alerta');
            }
        } else {
            redirect('', 'refresh');
        }
    }
    
    /*
     * Se AÃ±ade un nuevo Cliente desde Detalle - Servicios por MEV
     */
    function add_new($servicio_id)
    {
        if ($this->session->userdata('logged_in')) {
            $session_data = $this->session->userdata('logged_in');
            if($session_data['tipousuario_id']==1 or $session_data['tipousuario_id']==4) {
                $data = array(
                    'page_title' => 'Admin >> Mi Cuenta'
                );
                
                $this->load->model('Servicio_model');
                $data['servicio'] = $this->Servicio_model->get_servicio($servicio_id);

                if(isset($data['servicio']['servicio_id']))
                {
                    $this->load->library('form_validation');
                    $this->form_validation->set_rules('cliente_nombre','Cliente telefono','required');
                    $this->form_validation->set_rules('cliente_codigo','Cliente telefono','required');
                    $this->form_validation->set_rules('cliente_telefono','Cliente telefono','required');
                        
                    if($this->form_validation->run())     
                    {
                    if ($this->input->is_ajax_request()){
                    
                        $usuario_id = $session_data['usuario_id'];
                        $tipocliente_id = 1;
                        $categoria_clie = 1;
                        $cliente_ci = 0;
                        $cliente_nit = 0;
                        if($this->input->post('cliente_ci') == null){
                            $cliente_ci = rand(1000000, 99999999);
                        }else{
                            $cliente_ci = $this->input->post('cliente_ci');
                            $cliente_nit = $cliente_ci;
                        }
                        if($this->input->post('cliente_nit') == null){
                            if($cliente_nit ==0){
                                $cliente_nit = rand(10000000, 999999999);
                            }
                        }else{
                            $cliente_nit = $this->input->post('cliente_nit');
                        }

                        
                        $estado_id = 1; //$this->Estado_model->get_id_estado($estado_descripcion);
                        $mifecha = $this->Cliente_model->normalize_date($this->input->post('cliente_aniversario'));
                        $params = array(
                                    'estado_id' => $estado_id,
                                    'tipocliente_id' => $tipocliente_id,
                                    'categoriaclie_id' => $categoria_clie,
                                    'cliente_codigo' => $this->input->post('cliente_codigo'),
                                    'cliente_nombre' => $this->input->post('cliente_nombre'),
                                    'cliente_ci' => $cliente_ci,
                                    'cliente_direccion' => $this->input->post('cliente_direccion'),
                                    'cliente_telefono' => $this->input->post('cliente_telefono'),
                                    'cliente_celular' => $this->input->post('cliente_celular'),
                                    'cliente_foto' => $this->input->post('cliente_foto'),
                                    'cliente_email' => $this->input->post('cliente_email'),
                                    'cliente_nombrenegocio' => $this->input->post('cliente_nombrenegocio'),
                                    'cliente_aniversario' => $mifecha,
                                    'cliente_latitud' => $this->input->post('cliente_latitud'),
                                    'cliente_longitud' => $this->input->post('cliente_longitud'),
                                    'cliente_nit' => $cliente_nit,
                                    'cliente_razon' => $this->input->post('cliente_nombre'),
                                    'usuario_id' => $this->input->post('usuario_id'),
                                );
                            $cliente_id = $this->Cliente_model->add_cliente($params);
                            //tipousuario_id = 5 --> porque el tipo de usario es CLIENTE
                            $param = array(
                                                'estado_id' => $estado_id,
                                                'tipousuario_id' => 5,
                                                'usuario_nombre' => $this->input->post('cliente_nombre'),
                                                'usuario_email' => $this->input->post('cliente_email'),
                                                'usuario_login' => $cliente_ci,
                                                'usuario_clave' => md5($this->input->post('cliente_codigo')),
                            );

                            $this->load->model('Usuario_model');
                            $usuario_id = $this->Usuario_model->add_usuario($param);
                            /*$mas_params = array('cliente_codigo' =>'CSRV-'.$cliente_id);
                            $this->Cliente_model->update_cliente($cliente_id, $mas_params);
                            */
                            $params_serv = array('cliente_id' => $cliente_id);

                            $this->Servicio_model->update_servicio($servicio_id,$params_serv);

                        $datos = $this->Cliente_model->get_cliente($cliente_id);
                    echo json_encode($datos);
                    }else
                    {                 
                        show_404();
                    }
                }else{
                    echo json_encode("faltadatos");
                }
                }else{
                        show_error('El servicio al cual desea asignar un cliente, no existe');
                }
                
        }
            else{
                redirect('alerta');
            }
        } else {
            redirect('', 'refresh');
        }
    }
    
    /*
    * buscar clientes
    */
    function buscarclientes()
    {
        if ($this->session->userdata('logged_in')) {
            $session_data = $this->session->userdata('logged_in');
            if($session_data['tipousuario_id']==1 or $session_data['tipousuario_id']==4) {
                
                $usuario_id = $session_data['usuario_id'];

        if ($this->input->is_ajax_request()) {
            
            $parametro = $this->input->post('parametro');   
            //$limite = $this->input->post('limite');   
            
            if ($parametro!=""){
            $datos = $this->Cliente_model->get_busqueda_cliente_parametro($parametro);
            echo json_encode($datos);
            }
            else echo json_encode(null);
        }
        else
        {                 
            show_404();
        }
        }
            else{
                redirect('alerta');
            }
        } else {
            redirect('', 'refresh');
        }
    }
    
    
    /*
    * buscar clientes
    */
    function buscarclientes_usuario()
    {
        if ($this->session->userdata('logged_in')) {
            $session_data = $this->session->userdata('logged_in');
            if($session_data['tipousuario_id']==1 or $session_data['tipousuario_id']==4) {
                
                $usuario_id = $session_data['usuario_id'];

        if ($this->input->is_ajax_request()) {
            
            $parametro = $this->input->post('parametro');   
            $tipo = $this->input->post('tipo');
            
            if($tipo == 1){ //busque de solo mis clientes
                $condicion = " c.usuario_id = ".$usuario_id;
             
            }
            else{
                $condicion = " "; //busqueda de todos los clientes

            }
            
            
            if ($parametro!=""){
            $datos = $this->Cliente_model->get_cliente_por_usuario($parametro,$condicion);
            echo json_encode($datos);
            }
            else echo json_encode(null);
        }
        else
        {                 
            show_404();
        }
        }
            else{
                redirect('alerta');
            }
        } else {
            redirect('', 'refresh');
        }
    }
    
    /*
    * buscar clientes
    */
    function buscarclientesactivos()
    {
        if ($this->session->userdata('logged_in')) {
            $session_data = $this->session->userdata('logged_in');
            if($session_data['tipousuario_id']==1 or $session_data['tipousuario_id']==4) {
                
                $usuario_id = $session_data['usuario_id'];

        if ($this->input->is_ajax_request()) {
            
            $parametro = $this->input->post('parametro');   
            
            if ($parametro!=""){
            $datos = $this->Cliente_model->get_busqueda_cliente_activo_parametro($parametro);
            echo json_encode($datos);
            }
            else echo json_encode(null);
        }
        else
        {                 
            show_404();
        }
        }
            else{
                redirect('alerta');
            }
        } else {
            redirect('', 'refresh');
        }
    }
    
    /*
     * Ingresar nuevo cliente
     */
    function clientenuevo($pedido_id)
    {   
        
        if ($this->session->userdata('logged_in')) {
            $session_data = $this->session->userdata('logged_in');
            if($session_data['tipousuario_id']==1 or $session_data['tipousuario_id']==4) {

        
                $this->load->library('form_validation');

		$this->form_validation->set_rules('cliente_codigo','Cliente Codigo','required');
		$this->form_validation->set_rules('cliente_nombre','Cliente Nombre','required');
		
        if($this->form_validation->run())     
        {   
            $usuario_id = $session_data['usuario_id'];
            $params = array(
				'estado_id' => $this->input->post('estado_id'),
				'tipocliente_id' => $this->input->post('tipocliente_id'),
				'categoriaclie_id' => $this->input->post('categoriaclie_id'),
				'cliente_codigo' => $this->input->post('cliente_codigo'),
				'zona_id' => $this->input->post('zona_id'),
				'cliente_nombre' => $this->input->post('cliente_nombre'),
				'cliente_ci' => $this->input->post('cliente_ci'),
				'cliente_direccion' => $this->input->post('cliente_direccion'),
				'cliente_telefono' => $this->input->post('cliente_telefono'),
				'cliente_celular' => $this->input->post('cliente_celular'),
				'cliente_foto' => $this->input->post('cliente_foto'),
				'cliente_email' => $this->input->post('cliente_email'),
				'cliente_nombrenegocio' => $this->input->post('cliente_nombrenegocio'),
				'cliente_aniversario' => $this->input->post('cliente_aniversario'),
				'cliente_latitud' => $this->input->post('cliente_latitud'),
				'cliente_longitud' => $this->input->post('cliente_longitud'),
				'cliente_nit' => $this->input->post('cliente_nit'),
				'cliente_razon' => $this->input->post('cliente_razon'),
				'usuario_id' => $usuario_id,
            );
            
            $cliente_id = $this->Cliente_model->add_cliente($params);
            $this->load->model('Pedido_model');
            $this->Pedido_model->cambiar_cliente($pedido_id,$cliente_id);            
            redirect('pedido/pedidoabierto/'.$pedido_id);
        }
        else
        {
			$this->load->model('Estado_model');
			$data['all_estado'] = $this->Estado_model->get_all_estado();

			$this->load->model('Tipo_cliente_model');
			$data['all_tipo_cliente'] = $this->Tipo_cliente_model->get_all_tipo_cliente();

			$this->load->model('Categoria_cliente_model');
			$data['all_categoria_cliente'] = $this->Categoria_cliente_model->get_all_categoria_cliente();
            $data['pedido_id'] = $pedido_id;
            $data['_view'] = 'cliente/clientenuevo';
            $this->load->view('layouts/main',$data);
        }
        
       }
            else{
                redirect('alerta');
            }
        } else {
            redirect('', 'refresh');
        }        
        
    } 
    
    
    /*
     * Adding a new cliente
     */
    function cambiarcliente($cliente_id,$pedido_id,$cliente_nit,$cliente_razon)
    {   
//        $cliente_id = $this->input->post('cliente_id');
//        $pedido_id = $this->input->post('pedido_id');
//        $cliente_nit = $this->input->post('cliente_nit');
//        $cliente_razon = $this->input->post('cliente_razon');
//                  

        $this->load->model('Pedido_model');
        $sql = "update cliente set cliente_nit = '".$cliente_nit."',".
                "cliente_razon = '".$cliente_razon."' ".
                "where cliente_id = ".$cliente_id;        
        $this->Pedido_model->ejecutar($sql);       
        $this->Pedido_model->cambiar_cliente($pedido_id,$cliente_id);
        redirect('pedido/pedidoabierto/'.$pedido_id);
        
    }
    /*
    * buscar clientes limite 50
    */
    function buscarclienteslimit()
    {
        if ($this->session->userdata('logged_in')) {
            $session_data = $this->session->userdata('logged_in');
            if($session_data['tipousuario_id']==1 or $session_data['tipousuario_id']==4) {
                
                $usuario_id = $session_data['usuario_id'];

        if ($this->input->is_ajax_request()) {
            
            $parametro = $this->input->post('parametro');   
            //$limite = $this->input->post('limite');   
            
            /*if ($parametro!=""){*/
            $datos = $this->Cliente_model->get_all_cliente_limit();
            echo json_encode($datos);
            /*}
            else echo json_encode(null);*/
        }
        else
        {                 
            show_404();
        }
        }
            else{
                redirect('alerta');
            }
        } else {
            redirect('', 'refresh');
        }
    }
    /* buscar Todos los clientes */
    function buscarclientesall()
    {
        if ($this->session->userdata('logged_in')) {
            $session_data = $this->session->userdata('logged_in');
            if($session_data['tipousuario_id']==1 or $session_data['tipousuario_id']==4) {
                
                $usuario_id = $session_data['usuario_id'];

        if ($this->input->is_ajax_request())
        {
            $datos = $this->Cliente_model->get_all_cliente();
            echo json_encode($datos);
        }
        else
        {                 
            show_404();
        }
        }
            else{
                redirect('alerta');
            }
        } else {
            redirect('', 'refresh');
        }
    }
    
}
