<?php
/* 
 * Generated by CRUDigniter v3.2 
 * www.crudigniter.com
 */
 
class Vaciar_tabla extends CI_Controller{
    function __construct()
    {
        parent::__construct();
        $this->load->model('Vaciar_tabla_model');
    }
    
    /* * Listing of vaciar_tabla */
    function index()
    {
        $data['mensaje'] = 5;
        //$data['vaciar_tabla'] = $this->Vaciar_tabla_model->get_all_vaciar_tabla();
        
        $data['_view'] = 'vaciar_tabla/index';
        $this->load->view('layouts/main',$data);
    }

    /* * Adding a new vaciar_tabla */
    function leerarchivo()
    {
        $estecodigo = $this->input->post('codigo');
        $this->load->model('Tablapermiso_model');
        $codigo = $this->Tablapermiso_model->get_codigo();
        if($estecodigo === $codigo['para_vaciar']){
             /* *********************INICIO imagen***************************** */
            $arch="";
            if (!empty($_FILES['datos']['name']))
            {
                $this->load->library('image_lib');
                $config['upload_path'] = './resources/images/';
                $config['allowed_types'] = '*';
                $config['max_size'] = 0;
                /*$config['max_width'] = 2900;
                $config['max_height'] = 2900;*/

                $new_name = time(); //str_replace(" ", "_", $this->input->post('proveedor_nombre'));
                $config['file_name'] = $new_name; //.$extencion;
                $config['file_ext_tolower'] = TRUE;

                $this->load->library('upload', $config);
                $this->upload->do_upload('datos');

                $img_data = $this->upload->data();
                $extension = $img_data['file_ext'];

                $arch = $new_name.$extension;
                //$query = file_get_contents($config['upload_path'].$arch);
                $res = false;
                
                //$base_url = explode('/', base_url());
                $directorio = FCPATH.'resources\images\\';
                //$directorio = $_SERVER['DOCUMENT_ROOT'].'/'.$base_url[3].'/resources/images/';
                $res = $this->Vaciar_tabla_model->insertar_datos($directorio.$arch);
                if(isset($arch) && !empty($arch)){
                    if(file_exists($directorio.$arch)){
                        unlink($directorio.$arch);
                    }
                }
                if($res == true)
                {
                    $data['mensaje'] = 1;
                }else{
                    $data['mensaje'] = 2;
                }
                $data['_view'] = 'vaciar_tabla/index';
                $this->load->view('layouts/main',$data);
                //redirect('vaciar_tabla');
            }else{
                $data['mensaje'] = 0;
                $data['_view'] = 'vaciar_tabla/index';
                $this->load->view('layouts/main',$data);
                //redirect('vaciar_tabla');
            }
        }else{
                $data['mensaje'] = 4;
                $data['_view'] = 'vaciar_tabla/index';
                $this->load->view('layouts/main',$data);
            }
        /* *********************FIN imagen***************************** */
        //$query = readfile($config['upload_path'].$arch);
        //$query = file_get_contents($config['upload_path'].$arch);
        //$this->Vaciar_tabla_model->insertar_datos($query);
        
    }
    /*
     * truncar tabla
     */
    function vaciartabla()
    {
        $estecodigo = $this->input->post('codigo');
        $this->load->model('Tablapermiso_model');
        $codigo = $this->Tablapermiso_model->get_codigo();
        if($estecodigo === $codigo['para_vaciar']){
            $all_tabla = $this->Vaciar_tabla_model->get_all_tabla();
            foreach ($all_tabla as $tabla) {
                $res = $this->Vaciar_tabla_model->vaciar_tabla($tabla['tabla_nombre']);
            }
            $data['mensaje'] = 3;
            $data['_view'] = 'vaciar_tabla/index';
            $this->load->view('layouts/main',$data);
        }else{
        $data['mensaje'] = 4;
        $data['_view'] = 'vaciar_tabla/index';
        $this->load->view('layouts/main',$data);
        }
    }
    
}
