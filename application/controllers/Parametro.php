<?php
/* 
 * Generated by CRUDigniter v3.2 
 * www.crudigniter.com
 */
 
class Parametro extends CI_Controller{
    function __construct()
    {
        parent::__construct();
        $this->load->model('Parametro_model');
        $this->load->model('Moneda_model');
        if ($this->session->userdata('logged_in')) {
            $this->session_data = $this->session->userdata('logged_in');
        }else {
            redirect('', 'refresh');
        }
    } 
    private function acceso($id_rol){
        $rolusuario = $this->session_data['rol'];
        if($rolusuario[$id_rol-1]['rolusuario_asignado'] == 1){
            return true;
        }else{
            $data['_view'] = 'login/mensajeacceso';
            $this->load->view('layouts/main',$data);
        }
    } 


    /*
     * Listing of parametros
     */
    function index()
    {
        if($this->acceso(125)) {
        $this->load->model('Categoria_producto_model');
        $data['all_categoria_producto'] = $this->Categoria_producto_model->get_all_categoria_producto();
        $data['all_parametros'] = $this->Parametro_model->get_all_parametros();
        //$data['parametro'] = $this->Parametro_model->get_parametros();
        $data['moneda'] = $this->Moneda_model->get_moneda(2); //Obtener moneda extragera
        $data['page_title'] = "Parametro";
        $data['_view'] = 'parametro/index';
        $this->load->view('layouts/main',$data);
    }
    }

    /*
     * Adding a new parametro
     */
    function add()
    {
        if($this->acceso(125)) {
            $this->load->model('Categoria_producto_model');
            $data['all_categoria_producto'] = $this->Categoria_producto_model->get_all_categoria_producto();
        
        if(isset($_POST) && count($_POST) > 0)     
        {
            /* *********************INICIO imagen LOGO monitor***************************** */
                    $foto="";
                    if (!empty($_FILES['parametro_logomonitor']['name']))
                    {
                        $this->load->library('image_lib');
                        $config['upload_path'] = './resources/images/logo/';
                        $config['allowed_types'] = 'gif|jpeg|jpg|png';
                        $config['max_size'] = 0;
                        /*$config['max_width'] = 2900;
                        $config['max_height'] = 2900;*/

                        $new_name = time(); //str_replace(" ", "_", $this->input->post('proveedor_nombre'));
                        $config['file_name'] = $new_name; //.$extencion;
                        $config['file_ext_tolower'] = TRUE;

                        $this->load->library('upload', $config);
                        $this->upload->do_upload('parametro_logomonitor');

                        $img_data = $this->upload->data();
                        $extension = $img_data['file_ext'];
                        /* ********************INICIO para resize***************************** */
                        if($img_data['file_ext'] == ".jpg" || $img_data['file_ext'] == ".png" || $img_data['file_ext'] == ".jpeg" || $img_data['file_ext'] == ".gif") {
                            $conf['image_library'] = 'gd2';
                            $conf['source_image'] = $img_data['full_path'];
                            $conf['new_image'] = './resources/images/logo/';
                            $conf['maintain_ratio'] = TRUE;
                            $conf['create_thumb'] = FALSE;
                            $conf['width'] = 260;
                            $conf['height'] = 130;
                            $this->image_lib->clear();
                            $this->image_lib->initialize($conf);
                            if(!$this->image_lib->resize()){
                                echo $this->image_lib->display_errors('','');
                            }
                        }
                        /* ********************F I N  para resize***************************** */
                        $confi['image_library'] = 'gd2';
                        $confi['source_image'] = './resources/images/logo/'.$new_name.$extension;
                        $confi['new_image'] = './resources/images/logo/'."thumb_".$new_name.$extension;
                        $confi['create_thumb'] = FALSE;
                        $confi['maintain_ratio'] = TRUE;
                        $confi['width'] = 50;
                        $confi['height'] = 50;

                        $this->image_lib->clear();
                        $this->image_lib->initialize($confi);
                        $this->image_lib->resize();

                        $foto = $new_name.$extension;
                    }
                /* *********************FIN imagen LOGO monitor***************************** */
                /* *********************INICIO imagen FONDO monitor***************************** */
                    $fotoapo="";
                    if (!empty($_FILES['parametro_fondomonitor']['name']))
                    {
                        $this->load->library('image_lib');
                        $config1['upload_path'] = './resources/images/monitor/';
                        $config1['allowed_types'] = 'gif|jpeg|jpg|png';
                        $config1['max_size'] = 0;
                        /*$config1['max_width'] = 2900;
                        $config1['max_height'] = 2900;*/

                        $new_name1 = time(); //str_replace(" ", "_", $this->input->post('proveedor_nombre'));
                        $config1['file_name'] = $new_name1; //.$extencion;
                        $config1['file_ext_tolower'] = TRUE;

                        $this->load->library('upload', $config1);
                         $this->upload->initialize($config1);
                        $this->upload->do_upload('parametro_fondomonitor');

                        $img_data1 = $this->upload->data();
                        $extension1 = $img_data1['file_ext'];
                        /* ********************INICIO para resize***************************** */
                        if($img_data1['file_ext'] == ".jpg" || $img_data1['file_ext'] == ".png" || $img_data1['file_ext'] == ".jpeg" || $img_data1['file_ext'] == ".gif") {
                            $conf1['image_library'] = 'gd2';
                            $conf1['source_image'] = $img_data1['full_path'];
                            $conf1['new_image'] = './resources/images/monitor/';
                            $conf1['maintain_ratio'] = TRUE;
                            $conf1['create_thumb'] = FALSE;
                            $conf1['width'] = 1920;
                            $conf1['height'] = 1078;
                            $this->image_lib->clear();
                            $this->image_lib->initialize($conf1);
                            if(!$this->image_lib->resize()){
                                echo $this->image_lib->display_errors('','');
                            }
                        }
                        /* ********************F I N  para resize***************************** */
                        $confi1['image_library'] = 'gd2';
                        $confi1['source_image'] = './resources/images/monitor/'.$new_name1.$extension1;
                        $confi1['new_image'] = './resources/images/monitor/'."thumb_".$new_name1.$extension1;
                        $confi1['create_thumb'] = FALSE;
                        $confi1['maintain_ratio'] = TRUE;
                        $confi1['width'] = 50;
                        $confi1['height'] = 50;

                        $this->image_lib->clear();
                        $this->image_lib->initialize($confi1);
                        $this->image_lib->resize();

                        $fotoapo = $new_name1.$extension1;
                    }
                /* *********************FIN imagen FONDO monitor***************************** */
            $params = array(
                'parametro_numrecegr' => $this->input->post('parametro_numrecegr'),
                'parametro_numrecing' => $this->input->post('parametro_numrecing'),
                'parametro_copiasfact' => $this->input->post('parametro_copiasfact'),
                'parametro_tipoimpresora' => $this->input->post('parametro_tipoimpresora'),
                'parametro_numcuotas' => $this->input->post('parametro_numcuotas'),
                'parametro_montomax' => $this->input->post('parametro_montomax'),
                'parametro_diasgracia' => $this->input->post('parametro_diasgracia'),
                'parametro_diapago' => $this->input->post('parametro_diapago'),
                'parametro_periododias' => $this->input->post('parametro_periododias'),
                'parametro_interes' => $this->input->post('parametro_interes'),
                'parametro_diagnostico' => $this->input->post('parametro_diagnostico'),
                'parametro_mostrarcategoria' => $this->input->post('parametro_mostrarcategoria'),
                'parametro_solucion' => $this->input->post('parametro_solucion'),
                'parametro_modoventas' => $this->input->post('parametro_modoventas'),
                'parametro_imprimircomanda' => $this->input->post('parametro_imprimircomanda'),
                'parametro_anchoboton' => $this->input->post('parametro_anchoboton'),
                'parametro_altoboton' => $this->input->post('parametro_altoboton'),
                'parametro_tituldoc' => $this->input->post('parametro_tituldoc'),
                'parametro_colorboton' => $this->input->post('parametro_colorboton'),
                'parametro_anchoimagen' => $this->input->post('parametro_anchoimagen'),
                'parametro_altoimagen' => $this->input->post('parametro_altoimagen'),
                'parametro_formaimagen' => $this->input->post('parametro_formaimagen'),
                'parametro_modulorestaurante' => $this->input->post('parametro_modulorestaurante'),
                'parametro_permisocredito' => $this->input->post('parametro_permisocredito'),
                'parametro_agruparitems' => $this->input->post('parametro_agruparitems'),
                'parametro_diasvenc' => $this->input->post('parametro_diasvenc'),
                'parametro_anchofactura' => $this->input->post('parametro_anchofactura'),
                'parametro_altofactura' => $this->input->post('parametro_altofactura'),
                'parametro_margenfactura' => $this->input->post('parametro_margenfactura'),
                'parametro_imagenreal' => $this->input->post('parametro_imagenreal'),
                'parametro_diasentrega' => $this->input->post('parametro_diasentrega'),
                'parametro_segservicio' => $this->input->post('parametro_segservicio'),
                'parametro_notaentrega' => $this->input->post('parametro_notaentrega'),
                'parametro_apikey' => $this->input->post('parametro_apikey'),
                'parametro_serviciofact' => $this->input->post('parametro_serviciofact'),
                'parametro_logomonitor' => $foto,
                'parametro_fondomonitor' => $fotoapo,
                'parametro_cantidadproductos' => $this->input->post('parametro_cantidadproductos'),
                'parametro_datosboton' => $this->input->post('parametro_datosboton'),
                'moneda_id' => $this->input->post('moneda_id'),
                'parametro_numordenproduccion' => $this->input->post('parametro_numordenproduccion'),
                'parametro_factura' => $this->input->post('parametro_factura'),
                'parametro_puntos' => $this->input->post('parametro_puntos'),
                'parametro_mostrarmoneda' => $this->input->post('parametro_mostrarmoneda'),
                'parametro_pedidotitulo' => $this->input->post('parametro_pedidotitulo'),
                'parametro_manejocaja' => $this->input->post('parametro_manejocaja'),
                'parametro_codcatsubcat' => $this->input->post('parametro_codcatsubcat'),
                'parametro_tiposistema' => $this->input->post('parametro_tiposistema'),
                'parametro_tipoemision' => $this->input->post('parametro_tipoemision'),
            );
            
            $parametro_id = $this->Parametro_model->add_parametro($params);
            redirect('parametro/index');
        }
        else
        {
            $data['page_title'] = "Parametro";
            $this->load->model('Moneda_model');
            $data['all_moneda'] = $this->Moneda_model->getalls_monedasact_asc();
            $data['_view'] = 'parametro/add';
            $this->load->view('layouts/main',$data);
        }
    } 
    } 

    /*
     * Editing a parametro
     */
    function edit($parametro_id)
    {
        if($this->acceso(125)) {
        // check if the parametro exists before trying to edit it
        $data['parametro'] = $this->Parametro_model->get_esteparametro($parametro_id);
        $this->load->model('Categoria_producto_model');
        $data['all_categoria_producto'] = $this->Categoria_producto_model->get_all_categoria_producto();
        
        if(isset($data['parametro']['parametro_id']))
        {
            if(isset($_POST) && count($_POST) > 0)     
            {
                /* *********************INICIO imagen LOGO monitor***************************** */
                    $foto="";
                    $foto1= $this->input->post('parametro_logomonitor1');
                    if (!empty($_FILES['parametro_logomonitor']['name']))
                    {
                        $this->load->library('image_lib');
                        $config['upload_path'] = './resources/images/logo/';
                        $config['allowed_types'] = 'gif|jpeg|jpg|png';
                        $config['max_size'] = 0;
                        /*$config['max_width'] = 2900;
                        $config['max_height'] = 2900;*/

                        $new_name = time(); //str_replace(" ", "_", $this->input->post('proveedor_nombre'));
                        $config['file_name'] = $new_name; //.$extencion;
                        $config['file_ext_tolower'] = TRUE;

                        $this->load->library('upload', $config);
                        $this->upload->do_upload('parametro_logomonitor');

                        $img_data = $this->upload->data();
                        $extension = $img_data['file_ext'];
                        /* ********************INICIO para resize***************************** */
                        if($img_data['file_ext'] == ".jpg" || $img_data['file_ext'] == ".png" || $img_data['file_ext'] == ".jpeg" || $img_data['file_ext'] == ".gif") {
                            $conf['image_library'] = 'gd2';
                            $conf['source_image'] = $img_data['full_path'];
                            $conf['new_image'] = './resources/images/logo/';
                            $conf['maintain_ratio'] = TRUE;
                            $conf['create_thumb'] = FALSE;
                            $conf['width'] = 260;
                            $conf['height'] = 130;
                            $this->image_lib->clear();
                            $this->image_lib->initialize($conf);
                            if(!$this->image_lib->resize()){
                                echo $this->image_lib->display_errors('','');
                            }
                        }
                        /* ********************F I N  para resize***************************** */
                        //$directorio = base_url().'resources/imagenes/';
                        $base_url = explode('/', base_url());
                        $directorio = $_SERVER['DOCUMENT_ROOT'].'/'.$base_url[3].'/resources/images/logo/';
                        if(isset($foto1) && !empty($foto1)){
                          if(file_exists($directorio.$foto1)){
                              unlink($directorio.$foto1);
                              $mimagenthumb = "thumb_".$foto1;
                              if(file_exists($directorio.$mimagenthumb)){
                                  unlink($directorio.$mimagenthumb);
                              }
                          }
                      }
                        $confi['image_library'] = 'gd2';
                        $confi['source_image'] = './resources/images/logo/'.$new_name.$extension;
                        $confi['new_image'] = './resources/images/logo/'."thumb_".$new_name.$extension;
                        $confi['create_thumb'] = FALSE;
                        $confi['maintain_ratio'] = TRUE;
                        $confi['width'] = 50;
                        $confi['height'] = 50;

                        $this->image_lib->clear();
                        $this->image_lib->initialize($confi);
                        $this->image_lib->resize();

                        $foto = $new_name.$extension;
                    }else{
                        $foto = $foto1;
                    }
                /* *********************FIN imagen LOGO monitor***************************** */
                /* *********************INICIO imagen FONDO monitor***************************** */
                    $fotoapo="";
                    $fotoapo1= $this->input->post('parametro_fondomonitor1');
                    if (!empty($_FILES['parametro_fondomonitor']['name']))
                    {
                        $this->load->library('image_lib');
                        $config1['upload_path'] = './resources/images/monitor/';
                        $config1['allowed_types'] = 'gif|jpeg|jpg|png';
                        $config1['max_size'] = 0;
                        /*$config1['max_width'] = 2900;
                        $config1['max_height'] = 2900;*/

                        $new_name1 = time(); //str_replace(" ", "_", $this->input->post('proveedor_nombre'));
                        $config1['file_name'] = $new_name1; //.$extencion;
                        $config1['file_ext_tolower'] = TRUE;

                        $this->load->library('upload', $config1);
                         $this->upload->initialize($config1);
                        $this->upload->do_upload('parametro_fondomonitor');

                        $img_data1 = $this->upload->data();
                        $extension1 = $img_data1['file_ext'];
                        /* ********************INICIO para resize***************************** */
                        if($img_data1['file_ext'] == ".jpg" || $img_data1['file_ext'] == ".png" || $img_data1['file_ext'] == ".jpeg" || $img_data1['file_ext'] == ".gif") {
                            $conf1['image_library'] = 'gd2';
                            $conf1['source_image'] = $img_data1['full_path'];
                            $conf1['new_image'] = './resources/images/monitor/';
                            $conf1['maintain_ratio'] = TRUE;
                            $conf1['create_thumb'] = FALSE;
                            $conf1['width'] = 1920;
                            $conf1['height'] = 1078;
                            $this->image_lib->clear();
                            $this->image_lib->initialize($conf1);
                            if(!$this->image_lib->resize()){
                                echo $this->image_lib->display_errors('','');
                            }
                        }
                        /* ********************F I N  para resize***************************** */
                        //$directorio = base_url().'resources/imagenes/';
                        $base_url = explode('/', base_url());
                        $directorio1 = $_SERVER['DOCUMENT_ROOT'].'/'.$base_url[3].'/resources/images/monitor/';
                        if(isset($fotoapo1) && !empty($fotoapo1)){
                          if(file_exists($directorio1.$fotoapo1)){
                              unlink($directorio1.$fotoapo1);
                              $mimagenthumb1 = "thumb_".$fotoapo1;
                              if(file_exists($directorio1.$mimagenthumb1)){
                                  unlink($directorio1.$mimagenthumb1);
                              }
                          }
                      }
                        $confi1['image_library'] = 'gd2';
                        $confi1['source_image'] = './resources/images/monitor/'.$new_name1.$extension1;
                        $confi1['new_image'] = './resources/images/monitor/'."thumb_".$new_name1.$extension1;
                        $confi1['create_thumb'] = FALSE;
                        $confi1['maintain_ratio'] = TRUE;
                        $confi1['width'] = 50;
                        $confi1['height'] = 50;

                        $this->image_lib->clear();
                        $this->image_lib->initialize($confi1);
                        $this->image_lib->resize();

                        $fotoapo = $new_name1.$extension1;
                    }else{
                        $fotoapo = $fotoapo1;
                    }
                /* *********************FIN imagen FONDO monitor***************************** */
                $params = array(
                    'parametro_numrecegr' => $this->input->post('parametro_numrecegr'),
                    'parametro_numrecing' => $this->input->post('parametro_numrecing'),
                    'parametro_copiasfact' => $this->input->post('parametro_copiasfact'),
                    'parametro_tipoimpresora' => $this->input->post('parametro_tipoimpresora'),
                    'parametro_numcuotas' => $this->input->post('parametro_numcuotas'),
                    'parametro_montomax' => $this->input->post('parametro_montomax'),
                    'parametro_diasgracia' => $this->input->post('parametro_diasgracia'),
                    'parametro_diapago' => $this->input->post('parametro_diapago'),
                    'parametro_periododias' => $this->input->post('parametro_periododias'),
                    'parametro_interes' => $this->input->post('parametro_interes'),
                    'parametro_diagnostico' => $this->input->post('parametro_diagnostico'),
                    'parametro_mostrarcategoria' => $this->input->post('parametro_mostrarcategoria'),
                    'parametro_solucion' => $this->input->post('parametro_solucion'),
                    'parametro_modoventas' => $this->input->post('parametro_modoventas'),
                    'parametro_imprimircomanda' => $this->input->post('parametro_imprimircomanda'),
                    'parametro_anchoboton' => $this->input->post('parametro_anchoboton'),
                    'parametro_altoboton' => $this->input->post('parametro_altoboton'),
                    'parametro_tituldoc' => $this->input->post('parametro_tituldoc'),
                    'parametro_colorboton' => $this->input->post('parametro_colorboton'),
                    'parametro_anchoimagen' => $this->input->post('parametro_anchoimagen'),
                    'parametro_altoimagen' => $this->input->post('parametro_altoimagen'),
                    'parametro_formaimagen' => $this->input->post('parametro_formaimagen'),
                    'parametro_modulorestaurante' => $this->input->post('parametro_modulorestaurante'),
                    'parametro_permisocredito' => $this->input->post('parametro_permisocredito'),
                    'parametro_agruparitems' => $this->input->post('parametro_agruparitems'),
                    'parametro_diasvenc' => $this->input->post('parametro_diasvenc'),
                    'parametro_anchofactura' => $this->input->post('parametro_anchofactura'),
                    'parametro_altofactura' => $this->input->post('parametro_altofactura'),
                    'parametro_margenfactura' => $this->input->post('parametro_margenfactura'),
                    'parametro_imagenreal' => $this->input->post('parametro_imagenreal'),
                    'parametro_diasentrega' => $this->input->post('parametro_diasentrega'),
                    'parametro_segservicio' => $this->input->post('parametro_segservicio'),
                    'parametro_notaentrega' => $this->input->post('parametro_notaentrega'),
                    'parametro_apikey' => $this->input->post('parametro_apikey'),
                    'parametro_serviciofact' => $this->input->post('parametro_serviciofact'),
                    'parametro_logomonitor' => $foto,
                    'parametro_fondomonitor' => $fotoapo,
                    'parametro_cantidadproductos' => $this->input->post('parametro_cantidadproductos'),
                    'parametro_datosboton' => $this->input->post('parametro_datosboton'),
                    'moneda_id' => $this->input->post('moneda_id'),
                    'parametro_numordenproduccion' => $this->input->post('parametro_numordenproduccion'),
                    'parametro_factura' => $this->input->post('parametro_factura'),
                    'parametro_puntos' => $this->input->post('parametro_puntos'),
                    'parametro_mostrarmoneda' => $this->input->post('parametro_mostrarmoneda'),
                    'parametro_pedidotitulo' => $this->input->post('parametro_pedidotitulo'),
                    'parametro_manejocaja' => $this->input->post('parametro_manejocaja'),
                    'parametro_codcatsubcat' => $this->input->post('parametro_codcatsubcat'),
                    'parametro_tiposistema' => $this->input->post('parametro_tiposistema'),
                    'parametro_tipoemision' => $this->input->post('parametro_tipoemision'),
                );

                $this->Parametro_model->update_parametro($parametro_id,$params);            
                redirect('parametro/index');
            }
            else
            {
                $data['page_title'] = "Parametro";
                $this->load->model('Moneda_model');
                $data['all_moneda'] = $this->Moneda_model->getalls_monedasact_asc();
                $data['_view'] = 'parametro/edit';
                $this->load->view('layouts/main',$data);
            }
        }
        else
            show_error('The parametro you are trying to edit does not exist.');
    } 
}
    /*
     * Deleting parametro
     */
    function remove($parametro_id)
    {
        $parametro = $this->Parametro_model->get_parametro($parametro_id);

        // check if the parametro exists before trying to delete it
        if(isset($parametro['parametro_id']))
        {
            $this->Parametro_model->delete_parametro($parametro_id);
            redirect('parametro/index');
        }
        else
            show_error('The parametro you are trying to delete does not exist.');
    }
    
}
