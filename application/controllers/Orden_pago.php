<?php
/* 
 * Generated by CRUDigniter v3.2 
 * www.crudigniter.com
 */
 
class Orden_pago extends CI_Controller{
    function __construct()
    {
        parent::__construct();
        $this->load->model('Orden_pago_model');
        $this->load->model('Usuario_model');
    } 

    /*
     * Listing of orden_pago
     */
    function index()
    {
        $data['orden_pago'] = $this->Orden_pago_model->get_pago_pendiente();
        $data['usuario'] = $this->Orden_pago_model->get_usuarios();
        
        
        $data['_view'] = 'orden_pago/index';
        $this->load->view('layouts/main',$data);
    }

    function pagadas_hoy()
    {
        $data['orden_pago'] = $this->Orden_pago_model->get_pagadas_hoy();
        $data['usuario'] = $this->Orden_pago_model->get_usuarios();
        
        $data['_view'] = 'orden_pago/index';
        $this->load->view('layouts/main',$data);
    }

    function pagadas_antes()
    {
        $data['orden_pago'] = $this->Orden_pago_model->get_pagadas_antes();
        $data['usuario'] = $this->Orden_pago_model->get_usuarios();
        
        $data['_view'] = 'orden_pago/index';
        $this->load->view('layouts/main',$data);
    }

    /*
     * Adding a new orden_pago
     */
    function add()
    {   
        if(isset($_POST) && count($_POST) > 0)     
        {   
            $params = array(
				'usuario_id1' => $this->input->post('usuario_id1'),
				'usuario_id2' => $this->input->post('usuario_id2'),
				'proveedor_id' => $this->input->post('proveedor_id'),
				'estado_id' => $this->input->post('estado_id'),
				'cuota_id' => $this->input->post('cuota_id'),
				'compra_id' => $this->input->post('compra_id'),
				'orden_fecha' => $this->input->post('orden_fecha'),
				'orden_hora' => $this->input->post('orden_hora'),
				'orden_monto' => $this->input->post('orden_monto'),
				'orden_motivo' => $this->input->post('orden_motivo'),
				'orden_fechapago' => $this->input->post('orden_fechapago'),
				'orden_horapago' => $this->input->post('orden_horapago'),
				'orden_cobradapor' => $this->input->post('orden_cobradapor'),
				'orden_ci' => $this->input->post('orden_ci'),
            );
            
            $orden_pago_id = $this->Orden_pago_model->add_orden_pago($params);
            redirect('orden_pago/index');
        }
        else
        {
			$this->load->model('Usuario_model');
			$data['all_usuario'] = $this->Usuario_model->get_all_usuario();
			$data['all_usuario'] = $this->Usuario_model->get_all_usuario();

			$this->load->model('Proveedor_model');
			$data['all_proveedor'] = $this->Proveedor_model->get_all_proveedor();

			$this->load->model('Estado_model');
			$data['all_estado'] = $this->Estado_model->get_all_estado();

			$this->load->model('Cuotum_model');
			$data['all_cuota'] = $this->Cuotum_model->get_all_cuota();

			$this->load->model('Compra_model');
			$data['all_compra'] = $this->Compra_model->get_all_compra();
            
            $data['_view'] = 'orden_pago/add';
            $this->load->view('layouts/main',$data);
        }
    }  

    /*
     * Adding a new orden_pago
     */
    function nueva_orden()
    {   
        
        if ($this->session->userdata('logged_in')) {
            $session_data = $this->session->userdata('logged_in');
            if($session_data['tipousuario_id']==1 or $session_data['tipousuario_id']==4) {
                $data = array(
                    'page_title' => 'Admin >> Mi Cuenta'
                );
        //**************** inicio contenido ***************            
        
        $usuario_id = $session_data['usuario_id']; 
        $orden_fecha = "'".date("Y-m-d")."'"; 
        $orden_hora = "'".date("H:n:s")."'"; 
        $orden_monto = $this->input->post('orden_monto');
        $orden_motivo = "'".$this->input->post('orden_motivo')."'";
        $orden_destinatario = "'".$this->input->post('orden_destinatario')."'";
        
                
        if(isset($_POST) && count($_POST) > 0)     
        {   
            
            $sql = "insert into orden_pago(usuario_id1,usuario_id2,orden_monto,orden_destinatario,orden_motivo,orden_fecha,orden_hora,estado_id,orden_cancelado,cuota_id,compra_id) "
                    . "value(".$usuario_id.",0".",".$orden_monto.",".$orden_destinatario.",".$orden_motivo.",".$orden_fecha.",".$orden_hora.",8,0,0,0)";
            //echo $sql;
            $orden_pago_id = $this->Orden_pago_model->registrar_orden($sql);
            redirect('orden_pago/index');
        }
        else
        {
//			$this->load->model('Usuario_model');
//			$data['all_usuario'] = $this->Usuario_model->get_all_usuario();
//			$data['all_usuario'] = $this->Usuario_model->get_all_usuario();

//			$this->load->model('Proveedor_model');
//			$data['all_proveedor'] = $this->Proveedor_model->get_all_proveedor();

//			$this->load->model('Estado_model');
//			$data['all_estado'] = $this->Estado_model->get_all_estado();

//			$this->load->model('Cuotum_model');
//			$data['all_cuota'] = $this->Cuotum_model->get_all_cuota();

//			$this->load->model('Compra_model');
//			$data['all_compra'] = $this->Compra_model->get_all_compra();
            
                $data['_view'] = 'orden_pago/orden';
                $this->load->view('layouts/main',$data);
            
        }
        
        //**************** fin contenido ***************
        			}
        			else{ redirect('alerta'); }
        } else { redirect('', 'refresh'); }            
        
    }  

    function generar_orden($orden_monto,$orden_motivo,$orden_destinatario,$compra_id,$cuota_id)
    {   
        
        if ($this->session->userdata('logged_in')) {
            $session_data = $this->session->userdata('logged_in');
            if($session_data['tipousuario_id']==1 or $session_data['tipousuario_id']==4) {
                $data = array(
                    'page_title' => 'Admin >> Mi Cuenta'
                );
        //**************** inicio contenido ***************            
        
        $usuario_id = $session_data['usuario_id']; 
        $orden_fecha = "'".date("Y-m-d")."'"; 
        $orden_hora = "'".date("H:n:s")."'"; 
        
//        $orden_monto = $this->input->post('orden_monto');
//        $orden_motivo = "'".$this->input->post('orden_motivo')."'";
//        $orden_destinatario = "'".$this->input->post('orden_destinatario')."'";
//        
                
        if(isset($_POST) && count($_POST) > 0)     
        {   
            
            $sql = "insert into orden_pago(usuario_id1,usuario_id2,orden_monto,orden_destinatario,orden_motivo,orden_fecha,orden_hora,estado_id,orden_cancelado,compra_id,cuota_id) "
                    . "value(".$usuario_id.",0".",".$orden_monto.",".$orden_destinatario.",".$orden_motivo.",".$orden_fecha.",".$orden_hora.",8,0,".$compra_id.",".$cuota_id.")";
            //echo $sql;
            $orden_pago_id = $this->Orden_pago_model->registrar_orden($sql);
            redirect('orden_pago/index');
        }
        else
        {
//			$this->load->model('Usuario_model');
//			$data['all_usuario'] = $this->Usuario_model->get_all_usuario();
//			$data['all_usuario'] = $this->Usuario_model->get_all_usuario();

//			$this->load->model('Proveedor_model');
//			$data['all_proveedor'] = $this->Proveedor_model->get_all_proveedor();

//			$this->load->model('Estado_model');
//			$data['all_estado'] = $this->Estado_model->get_all_estado();

//			$this->load->model('Cuotum_model');
//			$data['all_cuota'] = $this->Cuotum_model->get_all_cuota();

//			$this->load->model('Compra_model');
//			$data['all_compra'] = $this->Compra_model->get_all_compra();
            
                $data['_view'] = 'orden_pago/orden';
                $this->load->view('layouts/main',$data);
            
        }
        
        //**************** fin contenido ***************
        			}
        			else{ redirect('alerta'); }
        } else { redirect('', 'refresh'); }            
        
    }  

    function pagar_orden($orden_id){
        
        
        if ($this->session->userdata('logged_in')) {
            $session_data = $this->session->userdata('logged_in');
            if($session_data['tipousuario_id']==1 or $session_data['tipousuario_id']==4) {
                $data = array(
                    'page_title' => 'Admin >> Mi Cuenta'
                );
        //**************** inicio contenido ***************            
        
        $usuario_id2 = $session_data['usuario_id']; 
        $orden_fechapago = "'".date("Y-m-d")."'"; 
        $orden_horapago = "'".date("H:n:s")."'"; 
        $orden_cancelado = $this->input->post('orden_cancelado'.$orden_id);
        $orden_cobradapor = "'".$this->input->post('orden_cobradapor'.$orden_id)."'";
        $orden_ci = "'".$this->input->post('orden_ci'.$orden_id)."'";
        $estado_id = 9;
                
            
        $sql = "update orden_pago set ".
               " usuario_id2 = ".$usuario_id2.
               ",orden_fechapago = ".$orden_fechapago.
               ",orden_horapago = ".$orden_horapago.
               ",orden_cancelado = ".$orden_cancelado.
               ",orden_cobradapor = ".$orden_cobradapor.
               ",orden_ci = ".$orden_ci.
               ",estado_id = ".$estado_id.
               " where orden_id = ".$orden_id;

        $orden_pago_id = $this->Orden_pago_model->registrar_orden($sql);
        redirect('orden_pago/index');

//        $data['_view'] = 'orden_pago/orden';
//        $this->load->view('layouts/main',$data);
            
        
        
        //**************** fin contenido ***************
            }
            else{ redirect('alerta'); }
        } else { redirect('', 'refresh'); }                    
        
    }         
    
    /*
     * Editing a orden_pago
     */
    function edit($orden_id)
    {   
        // check if the orden_pago exists before trying to edit it
        $data['orden_pago'] = $this->Orden_pago_model->get_orden_pago($orden_id);
        
        if(isset($data['orden_pago']['orden_id']))
        {
            if(isset($_POST) && count($_POST) > 0)     
            {   
                $params = array(
					'usuario_id1' => $this->input->post('usuario_id1'),
					'usuario_id2' => $this->input->post('usuario_id2'),
					'proveedor_id' => $this->input->post('proveedor_id'),
					'estado_id' => $this->input->post('estado_id'),
					'cuota_id' => $this->input->post('cuota_id'),
					'compra_id' => $this->input->post('compra_id'),
					'orden_fecha' => $this->input->post('orden_fecha'),
					'orden_hora' => $this->input->post('orden_hora'),
					'orden_monto' => $this->input->post('orden_monto'),
					'orden_motivo' => $this->input->post('orden_motivo'),
					'orden_fechapago' => $this->input->post('orden_fechapago'),
					'orden_horapago' => $this->input->post('orden_horapago'),
					'orden_cobradapor' => $this->input->post('orden_cobradapor'),
					'orden_ci' => $this->input->post('orden_ci'),
                );

                $this->Orden_pago_model->update_orden_pago($orden_id,$params);            
                redirect('orden_pago/index');
            }
            else
            {
				$this->load->model('Usuario_model');
				$data['all_usuario'] = $this->Usuario_model->get_all_usuario();
				$data['all_usuario'] = $this->Usuario_model->get_all_usuario();

				$this->load->model('Proveedor_model');
				$data['all_proveedor'] = $this->Proveedor_model->get_all_proveedor();

				$this->load->model('Estado_model');
				$data['all_estado'] = $this->Estado_model->get_all_estado();

				$this->load->model('Cuotum_model');
				$data['all_cuota'] = $this->Cuotum_model->get_all_cuota();

				$this->load->model('Compra_model');
				$data['all_compra'] = $this->Compra_model->get_all_compra();

                $data['_view'] = 'orden_pago/edit';
                $this->load->view('layouts/main',$data);
            }
        }
        else
            show_error('The orden_pago you are trying to edit does not exist.');
    } 

    /*
     * Deleting orden_pago
     */
    function remove($orden_id)
    {
        $orden_pago = $this->Orden_pago_model->get_orden_pago($orden_id);

        // check if the orden_pago exists before trying to delete it
        if(isset($orden_pago['orden_id']))
        {
            $this->Orden_pago_model->delete_orden_pago($orden_id);
            redirect('orden_pago/index');
        }
        else
            show_error('The orden_pago you are trying to delete does not exist.');
    }
    
}
