<?php
/* 
 * Generated by CRUDigniter v3.2 
 * www.crudigniter.com
 */
 
class Detalle_formula_aux_model extends CI_Model
{
    function __construct()
    {
        parent::__construct();
    }
    
    /*
     * funcion que elimina detalle_formula_aux deun determinado usuario
     */
    function delete_detalle_formula_aux($usuario_id)
    {
        return $this->db->delete('detalle_formula_aux',array('usuario_id'=>$usuario_id));
    }
    
    /*
     * inserta el detalle_formula de una Formula en detalle_formula_aux
     */
    function insertar_detalle_formula_aux($formula_id, $usuario_id, $tipo_cambio)
    {
        $detalle_formula = $this->db->query("
            insert into detalle_formula_aux
            (
            producto_id, venta_id, moneda_id, detalleven_codigo,
            detalleven_cantidad, detalleven_unidad, detalleven_costo, detalleven_precio,
            detalleven_subtotal, detalleven_descuento, detalleven_total, detalleven_caracteristicas,
            detalleven_preferencia, detalleven_comision, detalleven_tipocambio, usuario_id,
            detalleven_tc, producto_nombre, producto_unidad, producto_marca,
            categoria_id, producto_codigobarra
            
            )
            (SELECT
                p.producto_id, 0 as venta_id, p.moneda_id, p.producto_codigo,
                df.detalleformula_cantidad, p.producto_unidad, p.producto_costo, p.producto_precio,
                df.detalleformula_costo, 0, df.detalleformula_costo, p.producto_caracteristicas,
                '', p.producto_comision, p.producto_tipocambio, $usuario_id,
                '".$tipo_cambio."', p.producto_nombre, p.producto_unidad, p.producto_marca,
                p.categoria_id, p.producto_codigobarra
            FROM
              `detalle_formula` df
                LEFT JOIN producto p on df.producto_id = p.producto_id
            WHERE 
              df.formula_id = $formula_id)"
            ); //->result_array();

        return true;
    }
    
    /*
     * obtiene detalle_formula_aux dado un usuario_id
     */
    function get_all_detalles_porusuario($usuario_id)
    {
        $detalle_formula = $this->db->query("
            SELECT
                df.*
            FROM
                `detalle_formula_aux` df
            WHERE
                df.usuario_id = $usuario_id
            ORDER BY df.`detalleven_id` ASC
        ")->result_array();

        return $detalle_formula;
    }
    /*
     * function to update detalle_formula
     */
    function update_detalle_formula_aux($detalleven_id,$params)
    {
        $this->db->where('detalleven_id',$detalleven_id);
        return $this->db->update('detalle_formula_aux',$params);
    }
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    /*
     * Get detalle_formula by detalleformula_id
     */
    function get_detalle_formula($detalleformula_id)
    {
        $detalle_formula = $this->db->query("
            SELECT
                *

            FROM
                `detalle_formula`

            WHERE
                `detalleformula_id` = ?
        ",array($detalleformula_id))->row_array();

        return $detalle_formula;
    }
        
    /*
     * Get all detalle_formula
     */
    function get_all_detalle_formula()
    {
        $detalle_formula = $this->db->query("
            SELECT
                *

            FROM
                `detalle_formula`

            WHERE
                1 = 1

            ORDER BY `detalleformula_id` DESC
        ")->result_array();

        return $detalle_formula;
    }
        
    /*
     * function to add new detalle_formula
     */
    function add_detalle_formula($params)
    {
        $this->db->insert('detalle_formula',$params);
        return $this->db->insert_id();
    }
    
    
    
    
    
    /*
     * obtiene detalle_formula de Formula
     */
    function get_all_detalles_deuna_formula($formula_id)
    {
        $detalle_formula = $this->db->query("
            SELECT
                df.*, p.*
            FROM
                `detalle_formula` df
            LEFT JOIN producto p on df.producto_id = p.producto_id
            WHERE
                df.formula_id = $formula_id
            ORDER BY `detalleformula_id` DESC
        ")->result_array();

        return $detalle_formula;
    }
}
