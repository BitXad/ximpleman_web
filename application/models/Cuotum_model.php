<?php
/* 
 * Generated by CRUDigniter v3.2 
 * www.crudigniter.com
 */
 
class Cuotum_model extends CI_Model
{
    function __construct()
    {
        parent::__construct();
    }
    
    /*
     * Get cuotum by cuota_id
     */
    function get_cuotum($cuota_id)
    {
        $cuotum = $this->db->query("
            SELECT
                *

            FROM
                `cuota`

            WHERE
                `cuota_id` = ?
        ",array($cuota_id))->row_array();

        return $cuotum;
    }
        
    /*
     * Get all cuota
     */
    function get_all_cuota()
    {
        $cuota = $this->db->query("
            SELECT
                *

            FROM
                `cuota`

            WHERE
                1 = 1

            ORDER BY `cuota_id` DESC
        ")->result_array();

        return $cuota;
    }

    function get_cuota_compra()
    {
        $cuota = $this->db->query("
            SELECT
                c.*, cr.compra_id

            FROM
                cuota c, credito cr

            WHERE
                c.credito_id=cr.credito_id
                and cr.compra_id>0
                and c.estado_id=9

            ORDER BY `cuota_id` 
        ")->result_array();

        return $cuota;
    }

    function get_cuota_venta()
    {
        $cuota = $this->db->query("
            SELECT
                c.*, cr.venta_id

            FROM
                cuota c, credito cr

            WHERE
                c.credito_id=cr.credito_id
                and cr.venta_id>0
                and c.estado_id=9

            ORDER BY `cuota_id` 
        ")->result_array();

        return $cuota;
    }

     function get_all_deuda($credito_id)
    {
        $limit_condition = "";
        if(isset($params) && !empty($params))
            $limit_condition = " LIMIT " . $params['offset'] . "," . $params['limit'];
        
        $credito = $this->db->query("
            SELECT
                c.*, p.*, co.*, k.*, e.*, u.usuario_nombre

            FROM
                credito c, proveedor p, compra co, cuota k, estado e, usuario u

            WHERE
                k.credito_id = c.credito_id 
                and c.compra_id = co.compra_id
                and p.proveedor_id = co.proveedor_id
                and k.estado_id = e.estado_id
                and k.usuario_id = u.usuario_id
                and ".$credito_id." = k.credito_id

            ORDER BY `cuota_numcuota` ASC

            " . $limit_condition . "
        ")->result_array();

        return $credito;
    }
        
    function get_pendientes($credito_id)
    {
        $credito = $this->db->query("
            SELECT
                k.*

            FROM
               cuota k
            WHERE
             
                 k.credito_id = ".$credito_id." 
                 and k.estado_id = 8

            ORDER BY `cuota_id` ASC

          
        ")->result_array();

        return $credito;
    }

    function get_all_cuentas($credito_id)
    {
        
        
        $credito = $this->db->query("
            SELECT
                c.*, p.*, ve.*, k.cuota_fecha as fechacu, k.*, e.*, u.usuario_nombre, f.factura_id

            FROM
               cuota k
            LEFT JOIN credito c on k.credito_id = c.credito_id 
            LEFT JOIN venta ve on c.venta_id = ve.venta_id
            LEFT JOIN cliente p on p.cliente_id = ve.cliente_id
            LEFT JOIN estado e on k.estado_id = e.estado_id
            LEFT JOIN usuario u on k.usuario_id = u.usuario_id
            LEFT JOIN factura f on k.cuota_id=f.cuota_id
            WHERE
             
                 ".$credito_id." = k.credito_id

            ORDER BY `cuota_id` ASC

          
        ")->result_array();

        return $credito;
    }
    
    function get_all_cuenta_serv($credito_id)
    {
        $credito = $this->db->query("
            SELECT
                c.*, p.*, ve.*, k.cuota_fecha as fechacu, k.*, e.*, u.usuario_nombre, f.factura_id

            FROM
               cuota k
            LEFT JOIN credito c on k.credito_id = c.credito_id 
            LEFT JOIN servicio ve on c.servicio_id = ve.servicio_id
            LEFT JOIN cliente p on p.cliente_id = ve.cliente_id
            LEFT JOIN estado e on k.estado_id = e.estado_id
            LEFT JOIN usuario u on k.usuario_id = u.usuario_id
            LEFT JOIN factura f on k.cuota_id=f.cuota_id
            WHERE
             
                 ".$credito_id." = k.credito_id

            ORDER BY `cuota_id` ASC

            /*


            SELECT
                c.*, p.*, ve.*, k.cuota_fecha as fechacu, k.*, e.*,
                u.usuario_nombre, f.factura_id

            FROM
                credito c, cliente p, servicio ve, cuota k, estado e,
                usuario u
            WHERE
                k.credito_id = c.credito_id 
                and c.servicio_id = ve.servicio_id
                and p.cliente_id = ve.cliente_id
                and k.estado_id = e.estado_id
                and u.usuario_id = ve.usuario_id
                and ".$credito_id." = k.credito_id

            ORDER BY `cuota_numcuota` ASC*/
        ")->result_array();

        return $credito;
    }
    function get_recibo_deuda($cuota_id)
    {
        $limit_condition = "";
        if(isset($params) && !empty($params))
            $limit_condition = " LIMIT " . $params['offset'] . "," . $params['limit'];
        
        $cuota_id = $this->db->query("
            SELECT
                c.*, p.*, co.*, k.*, e.*

            FROM
                credito c, proveedor p, compra co, cuota k, estado e

            WHERE
                k.credito_id = c.credito_id 
                and c.compra_id = co.compra_id
                and p.proveedor_id = co.proveedor_id
                and k.estado_id = e.estado_id
                and ".$cuota_id." = k.cuota_id

            ORDER BY `cuota_numcuota` ASC

            " . $limit_condition . "
        ")->result_array();

        return $cuota_id;
    }
    function get_recibo_cuenta($cuota_id)
    {
        $limit_condition = "";
        if(isset($params) && !empty($params))
            $limit_condition = " LIMIT " . $params['offset'] . "," . $params['limit'];
        
        $cuota_id = $this->db->query("
            SELECT
                c.*, p.*, co.*, k.*, e.*

            FROM
                credito c, cliente p, venta co, cuota k, estado e

            WHERE
                k.credito_id = c.credito_id 
                and c.venta_id = co.venta_id
                and p.cliente_id = co.cliente_id
                and k.estado_id = e.estado_id
                and ".$cuota_id." = k.cuota_id

            ORDER BY `cuota_numcuota` ASC

            " . $limit_condition . "
        ")->result_array();

        return $cuota_id;
    }

    function get_recibo_cuentaServ($cuota_id)
    {
        $limit_condition = "";
        if(isset($params) && !empty($params))
            $limit_condition = " LIMIT " . $params['offset'] . "," . $params['limit'];
        
        $cuota_id = $this->db->query("
            SELECT
                c.*, p.*, co.*, k.*, e.*

            FROM
                credito c, cliente p, servicio co, cuota k, estado e

            WHERE
                k.credito_id = c.credito_id 
                and c.servicio_id = co.servicio_id
                and p.cliente_id = co.cliente_id
                and k.estado_id = e.estado_id
                and ".$cuota_id." = k.cuota_id

            ORDER BY `cuota_numcuota` ASC

            " . $limit_condition . "
        ")->result_array();

        return $cuota_id;
    }
    
    /*
     * function to add new cuotum
     */
    function add_cuotum($params)
    {
        $this->db->insert('cuota',$params);
        return $this->db->insert_id();
    }
    function numero()
    {
        
        $num = $this->db->query("SELECT * FROM parametros")->result_array();
        return $num;
    }  

    function interes($credito_id)
    {
        
     
        $credito = $this->db->query("
            SELECT
                credito_interesproc

            FROM
                credito

            WHERE
                `credito_id` = ?
        ",array($credito_id))->row_array();

        return $credito;
    } 

    function get_tipo($cuota_id)
    {
        $cuotum = $this->db->query("
            SELECT
                cr.venta_id, cr.servicio_id, cu.credito_id

            FROM
                credito cr, cuota cu

            WHERE
            cr.credito_id=cu.credito_id
            and cu.cuota_id = ".$cuota_id."
        ")->row_array();

        return $cuotum;
    }
    
    /*
     * function to update cuotum
     */
    function update_cuotum($cuota_id,$params)
    {
        $this->db->where('cuota_id',$cuota_id);
        return $this->db->update('cuota',$params);
    }
    
    /*
     * function to delete cuotum
     */
    function delete_cuotum($cuota_id)
    {
        return $this->db->delete('cuota',array('cuota_id'=>$cuota_id));
    }
}
