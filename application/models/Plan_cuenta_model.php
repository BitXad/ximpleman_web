<?php
/* 
 * Generated by CRUDigniter v3.2 
 * www.crudigniter.com
 */
 
class Plan_cuenta_model extends CI_Model{
    function __construct()
    {
        parent::__construct();
    }

    /*
    * Obtener todos los planes de cuentas
    * por defecto del nivel 1
    */
    function get_cuentas($nivel = 1){
        $p_cuentas =  $this->db->query(
            "select pc.*
            from plan_cuentas pc 
            where 1 = 1
            and pc.p_cuenta_nivel = $nivel 
            ")->result_array();
        return $p_cuentas;
    }

    function get_plan_cuentas($tipo, $nivel){
        $p_cuentas =  $this->db->query(
            "SELECT * 
            FROM plan_cuentas
            WHERE p_cuenta_tipo = $tipo
            AND p_cuenta_nivel = $nivel
            ORDER BY p_cuenta_num_cuenta
            ")->result_array();
        return $p_cuentas;
    }
    /**
     * obtener planes de cuentas por su tipo de plan
     */
    function get_tipo_planes($tipo){
        return $this->db->query(
            "SELECT pc.*
            from plan_cuentas pc 
            where pc.p_cuenta_tipo = $tipo
            order by pc.p_cuenta_id ,pc.p_cuenta_num
            "
        )->result_array();
    }
    /**
     * Obtener plan de cuenta por id
     */
    function get_cuenta($pc_id){
        return $this->db->query(
            "SELECT pc.*
            FROM plan_cuentas pc
            WHERE pc.p_cuenta_id = $pc_id
            "
        )->row_array();
    }
    /**
     * Obtener plan de cuenta por id
     */
    function get_cuenta_hijos($pc_id){
        return $this->db->query(
            "SELECT pc.*
            FROM plan_cuentas pc
            WHERE pc.p_cuenta_mayor = $pc_id
            order by pc.p_cuenta_num"
        )->result_array();
    }
    /**
     * Ultimo numero de cuenta por nivel y c_mayor
     */
    function get_ultimo_cnum($nivel, $c_mayor){
        return $this->db->query(
            "SELECT if(max(pc.p_cuenta_num)+1 is null, 1, max(pc.p_cuenta_num)+1) as ultimo
            from plan_cuentas pc 
            where pc.p_cuenta_nivel = $nivel
            $c_mayor"
        )->row_array();
    }
    /**
     * Agregar p_cuenta
    */
    function add($params){
        $this->db->insert('plan_cuentas',$params);
        return $this->db->insert_id();
    }

    function ultima_cuenta_tipo(){
        return $this->db->query(
            "SELECT if(max(pc.p_cuenta_tipo) is null, 1, max(pc.p_cuenta_tipo)+1) as ultimo 
            from plan_cuentas pc 
            where pc.p_cuenta_nivel = 1
            ")->row_array();
    }

    function get_p_cuenta($id){
        return $this->db->query(
            "SELECT pc.*
            from plan_cuentas pc
            where pc.p_cuenta_id = $id"
        )->row_array();
    }

    function update_plan_cuenta($id, $params){
        $this->db->where('p_cuenta_id',$id);
        return $this->db->update('plan_cuentas',$params);
    }

    function delete_plan_cuenta($p_cuenta_id){
        return $this->db->delete('plan_cuentas',array('p_cuenta_id'=>$p_cuenta_id));
    }
}
