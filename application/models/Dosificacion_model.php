<?php
/* 
 * Generated by CRUDigniter v3.2 
 * www.crudigniter.com
 */
 
class Dosificacion_model extends CI_Model
{
    function __construct()
    {
        parent::__construct();
    }
    
    /*
     * Get dosificacion by dosificacion_id
     */
    function get_dosificacion($dosificacion_id)
    {
        $dosificacion = $this->db->query("
            SELECT
                *

            FROM
                `dosificacion`

            WHERE
                `dosificacion_id` = ?
        ",array($dosificacion_id))->row_array();

        return $dosificacion;
    }
    
    /*
     * Retoran la ultima dosificacion activa
     */
    function get_dosificacion_activa()
    {
        $sql = "select * from dosificacion where estado_id = 1";
        $dosificacion = $this->db->query($sql)->result_array();

        return $dosificacion;
    }

    /*
     * Retoran la ultima dosificacion activa
     */

    /*
     * Get all dosificacion count
     */
    function get_all_dosificacion_count()
    {
        $dosificacion = $this->db->query("
            SELECT
                count(*) as count

            FROM
                `dosificacion`
        ")->row_array();

        return $dosificacion['count'];
    }
        
    /*
     * Get all dosificacion
     */
    function get_all_dosificacion($params = array())
    {
        $limit_condition = "";
        if(isset($params) && !empty($params))
            $limit_condition = " LIMIT " . $params['offset'] . "," . $params['limit'];
        
        $dosificacion = $this->db->query("
            SELECT
                d.`dosificacion_id`, e.`estado_descripcion`,
                em.`empresa_nombre`, d.`dosificacion_nitemisor`,
                d.`dosificacion_autorizacion`, d.`dosificacion_llave`,
                d.`dosificacion_numfact`, d.`dosificacion_leyenda1`,
                d.`dosificacion_leyenda2`, d.`dosificacion_sucursal`,
                d.`dosificacion_leyenda3`, d.`dosificacion_leyenda4`,
                d.`dosificacion_sfc`, d.`dosificacion_actividad`,
                d.`dosificacion_fechahora`, d.`dosificacion_leyenda5`, 
                d.`dosificacion_fechalimite`, d.`dosificasion_actividadsec`

            FROM
                dosificacion d, estado e, empresa em

            WHERE
                d.estado_id = e.estado_id
                and d.empresa_id = em.empresa_id and
                d.dosificacion_fechalimite >= date(now())

            ORDER BY `dosificacion_id` DESC

            " . $limit_condition . "
        ")->result_array();

        return $dosificacion;
    }
        
    /*
     * function to add new dosificacion
     */
    function add_dosificacion($params)
    {
        $this->db->insert('dosificacion',$params);
        return $this->db->insert_id();
    }
    
    /*
     * function to update dosificacion
     */
    function update_dosificacion($dosificacion_id,$params)
    {
        $this->db->where('dosificacion_id',$dosificacion_id);
        return $this->db->update('dosificacion',$params);
    }
    
    /*
     * function to delete dosificacion
     */
    function delete_dosificacion($dosificacion_id)
    {
        return $this->db->delete('dosificacion',array('dosificacion_id'=>$dosificacion_id));
    }
    
    /*
     * Obtiene la dosificacion para notas de entrega de Servicios
     */
    function get_all_dosificacion_servicio()
    {
        $dosificacion = $this->db->query("
            SELECT
                d.`dosificacion_id`, e.`estado_descripcion`,
                em.`empresa_nombre`, d.`dosificacion_leyenda2`,
                d.`dosificacion_leyenda3`, d.`dosificacion_leyenda4`,
                d.`dosificacion_leyenda5`
            FROM
                dosificacion d, estado e, empresa em

            WHERE
                d.estado_id = e.estado_id
                and d.empresa_id = em.empresa_id
                
        ")->row_array();

        return $dosificacion;
    }
    /*
     * Obtiene la dosificacion leyenda 5
     */
    function get_dosificacion_leyenda5()
    {
        $dosificacion = $this->db->query("
            SELECT
                d.`dosificacion_leyenda5`
            FROM
                dosificacion d

            WHERE
                1 = 1
                
        ")->row_array();

        return $dosificacion;
    }
    /*
     * Obtiene la dosificacion leyenda 3
     */
    function get_dosificacion_leyenda3()
    {
        $dosificacion = $this->db->query("
            SELECT
                d.`dosificacion_leyenda3`
            FROM
                dosificacion d

            WHERE
                1 = 1
                
        ")->row_array();

        return $dosificacion;
    }
    
    /*
     * Get this dosificacion
     */
    function get_this_dosificacion()
    {
        $dosificacion = $this->db->query("
            SELECT
                d.*, e.`estado_descripcion`,
                em.`empresa_nombre`
                
            FROM
                dosificacion d, estado e, empresa em

            WHERE
                d.estado_id = e.estado_id
                and d.empresa_id = em.empresa_id

            ORDER BY `dosificacion_id` DESC
            
        ")->row_array();

        return $dosificacion;
    }
    
}
