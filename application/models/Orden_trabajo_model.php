<?php
/* 
 * Generated by CRUDigniter v3.2 
 * www.crudigniter.com
 */
 
class Orden_trabajo_model extends CI_Model
{
    function __construct()
    {
        parent::__construct();
    }
    
    /*
     * Get orden_trabajo by orden_trabajo_id
     */
    function get_orden_trabajo($orden_trabajo_id)
    {
        return $this->db->get_where('orden_trabajo',array('orden_trabajo_id'=>$orden_trabajo_id))->row_array();
    }
       function get_orden_trabajo_usuario($usuario_id)
    {
        return $this->db->get_where('usuario',array('usuario_id'=>$usuario_id))->row_array();
    }   
    /*
     * Get all orden_trabajo
     */
    function get_all_orden_trabajo()
    {
         
        $orden_trabajo = $this->db->query("
            SELECT
                c.*, u.*, cli.cliente_nombre

            FROM
                orden_trabajo c, usuario u, cliente cli
            WHERE
                c.usuario_id = u.usuario_id and 
                c.cliente_id = cli.cliente_id
               
            ORDER BY `orden_id` DESC limit 1000

        ")->result_array();

        return $orden_trabajo;
    }
        
    /*
     * function to add new orden_trabajo
     */
 function get_detalle_orden_trabajo($usuario_id)
    {
        $sql = "SELECT d.*, p.* from detalle_orden d, inventario p
               where d.producto_id=p.producto_id and d.usuario_id = ".$usuario_id." and d.orden_is is null
               order by d.detalleorden_id desc";
        $result = $this->db->query($sql)->result_array();
        return $result;        
    } 

 function crear_orden_trabajo($usuario_id)
    {
        $usuario_id = 1;
        $orden_trabajo_fechahora = "'".date("Y-m-d   H:i:s")."'";
        
        $sql = "insert into orden_trabajo(orden_trabajo_fecha) ".
                "value(".$orden_trabajo_fechahora.")";
        $orden_trabajo = $this->db->query($sql);
        $orden_trabajo_id = $this->db->insert_id();
        return $orden_trabajo_id;        
        
    }

     function normalize_date($date)
    {
        if (!empty($date)) {
            return implode("-", array_reverse(explode("/", $date)));            
        }
        else{
            return "2000-01-01";
        }

    }

    function add_orden_trabajo($params)
    {
        $this->db->insert('orden_trabajo',$params);
        return $this->db->insert_id();
    }
    
    /*
     * function to update orden_trabajo
     */
    function update_orden_trabajo($orden_trabajo_id,$params)
    {
        $this->db->where('orden_trabajo_id',$orden_trabajo_id);
        return $this->db->update('orden_trabajo',$params);
    }
    
    function ejecutar($sql)
    {
        $orden_trabajo = $this->db->query($sql);
        return $orden_trabajo;
        
    }
    /*
     * function to delete orden_trabajo
     */
    function delete_orden_trabajo($orden_trabajo_id)
    {
        return $this->db->delete('orden_trabajo',array('orden_trabajo_id'=>$orden_trabajo_id));
    }
}
