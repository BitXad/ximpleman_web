<?php
/* 
 * Generated by CRUDigniter v3.2 
 * www.crudigniter.com
 */
 
class Reporte_ing_egr_model extends CI_Model
{
    function __construct()
    {
        parent::__construct();
    }
function get_reportes($fecha1, $fecha2)
    {
        $ingresos = $this->db->query("
                  
      select 
            v.venta_fecha as fecha, p.producto_nombre as detalle,
            d.detalleven_total as ingreso, 0 as egreso,
            d.detalleven_total-(d.detalleven_costo * d.detalleven_cantidad) as utilidad
      from
            venta v, detalle_venta d, producto p
      where
            v.venta_fecha >= '".$fecha1."'
            and v.venta_fecha <= '".$fecha2."'
            and v.venta_id = d.venta_id
            and d.producto_id = p.producto_id
      UNION
      (select 
            c.compra_fecha as fecha, p.producto_nombre as detalle,
            0 as ingreso, d.detallecomp_total as egreso,
            0 as utilidad
      from
            compra c, detalle_compra d, producto p
      where
            c.compra_fecha >= '".$fecha1."'
            and c.compra_fecha <= '".$fecha2."'
            and c.compra_id = d.compra_id
            and d.producto_id = p.producto_id)
      UNION
      (select 
            i.ingreso_fecha as fecha, i.ingreso_nombre as detalle,
            i.ingreso_monto as ingreso, 0 as egreso,
            0 as utilidad
      from
            ingresos i
      where
            i.ingreso_fecha >= '".$fecha1."'
            and i.ingreso_fecha <= '".$fecha2."')
      UNION
      (select 
            e.egreso_fecha as fecha, e.egreso_nombre as detalle,
            0 as ingreso, e.egreso_monto as egreso,
            0 as utilidad
      from
            egresos e
      where
            e.egreso_fecha >= '".$fecha1."'
            and e.egreso_fecha <= '".$fecha2."')
      UNION
      (select 
            c.cuota_fecha as fecha, concat('Pago por credito N°: ', c.credito_id) as detalle,
            0 as ingreso, c.cuota_total as egreso,
            0 as utilidad
      from
            cuota c, credito cr
      where
            c.cuota_fecha >= '".$fecha1."'
            and c.cuota_fecha <= '".$fecha2."'
            and c.credito_id = cr.credito_id
            and cr.credito_tipo = 1)
      UNION
      (select 
            c.cuota_fecha as fecha, concat('Cuota credito N°: ', c.credito_id) as detalle,
            c.cuota_total as ingreso, 0 as egreso,
            c.cuota_interes as utilidad
      from
            cuota c, credito cr
      where
            c.cuota_fecha >= '".$fecha1."'
            and c.cuota_fecha <= '".$fecha2."'
            and c.credito_id = cr.credito_id
            and cr.credito_tipo = 2)




        ")->result_array();
        /*$ingresos = $this->db->query("
            SELECT v.venta_fecha AS Fecha, p.producto_nombre as Detalle, d.detalleven_total as Ingreso, 0 as Egreso, d.detalleven_total-(d.detalleven_costo * d.detalleven_cantidad)  as Utilidad
            FROM venta v, detalle_venta d, producto p
            WHERE v.venta_id = d.venta_id and d.producto_id = p.producto_id
            UNION
            SELECT c.compra_fecha AS Fecha, p.producto_nombre as Detalle,0 as Ingreso, d.detallecomp_total as Egreso,0 as Utilidad
            FROM compra c, detalle_compra d, producto p
            WHERE c.compra_id =d.compra_id and d.producto_id = p.producto_id
            UNION

            SELECT date (i.ingreso_fecha) AS Fecha, i.ingreso_concepto as Detalle, i.ingreso_monto as Ingreso,0 as Egreso, 0 as Utilidad
            FROM ingresos i
            UNION

            SELECT date (e.egreso_fecha) AS Fecha, e.egreso_concepto as Detalle, 0 as Ingreso,e.egreso_monto as Egreso, 0 as Utilidad
            FROM egresos e




        ")->result_array(); */

        return $ingresos;
    }
}
?>