<?php
/* 
 * Generated by CRUDigniter v3.2 
 * www.crudigniter.com
 */
 
class Cotizacion_model extends CI_Model
{
    function __construct()
    {
        parent::__construct();
    }
    
    /*
     * Get cotizacion by cotizacion_id
     */
    function get_cotizacion($cotizacion_id)
    {
        return $this->db->get_where('cotizacion',array('cotizacion_id'=>$cotizacion_id))->row_array();
    }
       function get_cotizacion_usuario($usuario_id)
    {
        return $this->db->get_where('usuario',array('usuario_id'=>$usuario_id))->row_array();
    }   
    /*
     * Get all cotizacion
     */
    function get_all_cotizacion()
    {
         
        $cotizacion = $this->db->query("
            SELECT
                c.*, u.*

            FROM
                cotizacion c, usuario u
            WHERE
                c.usuario_id = u.usuario_id
               
            ORDER BY `cotizacion_id` DESC limit 100

        ")->result_array();

        return $cotizacion;
    }

    function get_fechas_cotizacion($parametro)
    {
         
        $cotizacion = $this->db->query("
            SELECT
                c.*, u.*

            FROM
                cotizacion c, usuario u
            WHERE
                c.usuario_id = u.usuario_id

                ".$parametro."
               
            ORDER BY `cotizacion_id` DESC

        ")->result_array();

        return $cotizacion;
    }
        
    /*
     * function to add new cotizacion
     */
 function get_detalle_cotizacion($cotizacion_id)
    {
        $sql = "SELECT d.*, p.* from detalle_cotizacion d, inventario p
               where d.producto_id=p.producto_id and d.cotizacion_id = ".$cotizacion_id."
               order by d.detallecot_id asc";
        $result = $this->db->query($sql)->result_array();
        return $result;        
    } 

 function crear_cotizacion($usuario_id)
    {
        //$usuario_id = 1;
        $cotizacion_fechahora = "'".date("Y-m-d   H:i:s")."'";
        
        $sql = "insert into cotizacion(cotizacion_fecha) ".
                "value(".$cotizacion_fechahora.")";
        $cotizacion = $this->db->query($sql);
        $cotizacion_id = $this->db->insert_id();
        return $cotizacion_id;        
        
    }

     function normalize_date($date)
    {
        if (!empty($date)) {
            return implode("-", array_reverse(explode("/", $date)));            
        }
        else{
            return "2000-01-01";
        }

    }

    function add_cotizacion($params)
    {
        $this->db->insert('cotizacion',$params);
        return $this->db->insert_id();
    }
    
    /*
     * function to update cotizacion
     */
    function update_cotizacion($cotizacion_id,$params)
    {
        $this->db->where('cotizacion_id',$cotizacion_id);
        return $this->db->update('cotizacion',$params);
    }
    
    function ejecutar($sql)
    {
        $cotizacion = $this->db->query($sql);
        
        //echo $sql;
        return $cotizacion;
        
    }
    /*
     * function to delete cotizacion
     */
    function delete_cotizacion($cotizacion_id)
    {
        return $this->db->delete('cotizacion',array('cotizacion_id'=>$cotizacion_id));
    }
}
